(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{618:function(t,e,r){"use strict";r.r(e);var n=r(463),c=r(221),o=r(208),_=r(63),l=r(528),d=r(525),v=r(531),m=r(453),x=r(72),f=r(206),h=r(142),y=r(90),k=r(609),w=r(510),C=r(466),D=r(610),T=r(611),S=r(622),j=(r(43),r(36),r(55),r(41),r(24),r(8),r(56),r(60),r(42),r(28)),I=(r(78),r(301),r(498),r(3),r(77),r(559)),A=r.n(I);function R(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return F(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,_=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){_=!0,c=t},f:function(){try{o||null==r.return||r.return()}finally{if(_)throw c}}}}function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var O={name:"UsersTicketsPage",data:function(){return{user:{},userdata_qr:"",unused_tickets:[],used_tickets:[],display_userid:!1,cancel_dialog:!1,success_alert:!1,error_alert:!1,success_message:"",error_message:""}},asyncData:function(t){return Object(j.a)(regeneratorRuntime.mark((function e(){var r,n,c,o,_,l,d,v,m,x,f,h,y,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.params,r=t.error,n=t.$axios,e.next=3,n.get("/users/me").then((function(t){c=t.data})).catch((function(t){r({message:t.message})}));case 3:if(o="",0!=c.is_active){e.next=8;break}return'{"user_id":user.id}',e.next=8,A.a.toDataURL('{"user_id":user.id}',{width:250}).then((function(code){o=code})).catch((function(t){console.error(t)}));case 8:return _=[],l=[],d=[],e.next=13,n.get("/users/me/tickets").then((function(t){_=t.data})).catch((function(t){r({message:t.message})}));case 13:v=R(_),e.prev=14,v.s();case 16:if((m=v.n()).done){e.next=36;break}return x=m.value,f=void 0,h=void 0,y=void 0,k=void 0,e.next=24,n.get("/groups/"+x.group_id).then((function(t){h=t.data})).catch((function(t){r({message:t.message})}));case 24:return e.next=26,n.get("/groups/"+x.group_id+"/events/"+x.event_id).then((function(t){y=t.data})).catch((function(t){r({message:t.message})}));case 26:return e.next=28,n.get("/timetable/"+y.timetable_id).then((function(t){k=t.data})).catch((function(t){r({message:t.message})}));case 28:k.sell_at=new Date(k.sell_at),k.sell_ends=new Date(k.sell_ends),k.starts_at=new Date(k.starts_at),k.ends_at=new Date(k.ends_at),f={group:h,event:y,ticket:x,timetable:k,detail_show:!1},Date.now()<=k.starts_at.getTime()+6e5?l.push(f):d.push(f);case 34:e.next=16;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(14),v.e(e.t0);case 41:return e.prev=41,v.f(),e.finish(41);case 44:return l.sort((function(t,e){return t.timetable.starts_at.getTime()<e.timetable.starts_at.getTime()?-1:t.timetable.starts_at.getTime()>e.timetable.starts_at.getTime()?1:0})),d.sort((function(t,e){return t.timetable.starts_at.getTime()<e.timetable.starts_at.getTime()?-1:t.timetable.starts_at.getTime()>e.timetable.starts_at.getTime()?1:0})),e.abrupt("return",{user:c,userdata_qr:o,unused_tickets:l,used_tickets:d});case 47:case"end":return e.stop()}}),e,null,[[14,38,41,44]])})))()},methods:{DateFormatter:function(t){return t.getMonth()+1+"月"+t.getDate()+"日 "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")},CancelTicket:function(t){var e=this;return Object(j.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.$axios.delete("/groups/"+t.group.id+"/events/"+t.event.id+"/tickets/"+t.ticket.id).then((function(t){e.success_alert=!0,e.success_message="整理券が正常にキャンセルされました"})).catch((function(t){e.error_alert=!0,e.error_message=t.message}));case 2:e.cancel_dialog=!1,e.$nuxt.refresh();case 4:case"end":return r.stop()}}),r)})))()}}},N=r(96),component=Object(N.a)(O,(function(){var t=this,e=t._self._c;return e(n.a,[e(d.a,{staticClass:"px-1",attrs:{name:"ticket_container"}},[e(k.a,{attrs:{justify:"center","align-content":"center"}},[e(l.a,{attrs:{col:"6",md:"6",sm:"12"}},[0==t.user.is_active?e(o.a,{attrs:{outlined:""}},[e(_.d,{staticClass:"ma-3 pa-0 red--text text-subtitle-1"},[e(f.a,{attrs:{color:"red"}},[t._v("mdi-alert-circle")]),t._v("\n              未アクティベートなアカウント\n            ")],1),t._v(" "),e("p",{staticClass:"caption mx-3 my-1 grey--text text--darken-1"},[t._v("整理券を取得・使用するには校内への入場処理が必要です。以下のQRコードまたはユーザーIDを校門にいるチーフ会の生徒に提示してください")]),t._v(" "),e("p",{staticClass:"caption mx-3 my-1 grey--text text--darken-1"},[t._v("※本校生徒のアカウントは開場と同時にアクティベートされます")]),t._v(" "),e("img",{staticClass:"mx-1 my-0",staticStyle:{display:"block"},attrs:{src:t.userdata_qr}}),t._v(" "),e("div",{staticClass:"mx-3 my-1"},[e("a",{staticClass:"text-subtitle-2",on:{click:function(e){t.display_userid=!t.display_userid}}},[t._v("ユーザーIDを表示：")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.display_userid,expression:"display_userid"}]},[t._v(t._s(t.user.id))])])],1):t._e(),t._v(" "),e("div",{staticClass:"my-3"}),t._v(" "),e(S.a,{attrs:{centered:""}},[e(D.a,[t._v("\n                未使用\n              ")]),t._v(" "),e(D.a,[t._v("\n                使用済み（投票券）\n              ")]),t._v(" "),e("div",{staticClass:"my-2"}),t._v(" "),e(T.a,[t._l(t.unused_tickets,(function(r){return e("div",[e(o.a,{staticClass:"mx-auto",attrs:{maxWidth:"100%",outlined:"",rounded:"",elevation:"2"}},[e(h.a,{attrs:{"two-line":""}},[e(y.a,[e(y.c,{staticClass:"text-h7 mb-1"},[t._v(t._s(r.group.title)+" - "+t._s(r.group.groupname))]),t._v(" "),e(y.b,[t._v(t._s(r.timetable.timetablename))])],1),t._v(" "),e(_.a,[e(c.a,{attrs:{icon:""},on:{click:function(t){r.detail_show=!r.detail_show}}},[e(f.a,[t._v(t._s(r.detail_show?"mdi-chevron-up":"mdi-chevron-down"))])],1)],1)],1),t._v(" "),e(x.a,[e("div",{directives:[{name:"show",rawName:"v-show",value:r.detail_show,expression:"unused_ticket.detail_show"}],staticClass:"pa-1"},[e(m.a),t._v(" "),e(_.c,{staticClass:"pa-1"},[e("a",{staticClass:"text-body-2 mx-0 my-0 pa-0",attrs:{href:"/groups/"+r.group.id}},[t._v(t._s(r.group.groupname)+"の団体紹介ページ")]),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e(f.a,[t._v("mdi-clock-time-nine")]),e("span",{staticClass:"grey--text text--darken-2"},[t._v("開幕時刻：")]),t._v(t._s(t.DateFormatter(r.timetable.starts_at))+" ~ "+t._s(t.DateFormatter(r.timetable.ends_at)))],1),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e(f.a,[t._v("mdi-account-supervisor")]),e("span",{staticClass:"grey--text text--darken-2"},[t._v("同時入場人数：")]),t._v(t._s(r.ticket.person))],1),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e("span",{staticClass:"grey--text text--darken-2"},[t._v("ID：")]),t._v(t._s(r.ticket.id))]),t._v(" "),e(c.a,{on:{click:function(e){t.cancel_dialog=!0}}},[e(f.a,[t._v("mdi-close")]),t._v(" "),e("p",{staticClass:"pa-0 ma-0"},[t._v("このチケットをキャンセル")])],1)],1)],1)]),t._v(" "),e(v.a,{attrs:{"max-width":"300"},model:{value:t.cancel_dialog,callback:function(e){t.cancel_dialog=e},expression:"cancel_dialog"}},[e(o.a,[e(_.d,{staticClass:"text-h5"},[t._v(t._s(r.group.title)+" - "+t._s(r.group.groupname)+"の整理券をキャンセルしてもよろしいですか？")]),t._v(" "),e(_.c,[t._v("このアクションは取り消せません")]),t._v(" "),e(_.a,[e(C.a),t._v(" "),e(c.a,{attrs:{text:""},on:{click:function(e){t.cancel_dialog=!1}}},[t._v("いいえ")]),t._v(" "),e(c.a,{attrs:{color:"primary"},on:{click:function(e){return t.CancelTicket(r)}}},[t._v("はい")])],1)],1)],1)],1),t._v(" "),e("div",{staticClass:"my-2"})],1)})),t._v(" "),0==t.unused_tickets.length?e("div",{staticClass:"pa-3"},[e("p",[t._v("ここに表示するものはありません")]),t._v(" "),e("a",{staticClass:"amber--text text--darken-4",attrs:{href:"/groups"}},[t._v("次に見たい公演を探しに行きましょう✨")])]):t._e()],2),t._v(" "),e(T.a,[t._l(t.used_tickets,(function(r){return e("div",[e(o.a,{staticClass:"mx-auto",attrs:{maxWidth:"100%",outlined:"",rounded:"",elevation:"2"}},[e(h.a,{attrs:{"two-line":""}},[e(y.a,[e(y.c,{staticClass:"text-h7 mb-1"},[t._v(t._s(r.group.title)+" - "+t._s(r.group.groupname))]),t._v(" "),e(y.b,[t._v(t._s(r.timetable.timetablename))])],1),t._v(" "),e("v-card-action",[e(c.a,{directives:[{name:"show",rawName:"v-show",value:r.group.enable_vote,expression:"used_ticket.group.enable_vote"}],attrs:{to:"/vote"}},[e(f.a,[t._v("mdi-vote")]),t._v(" "),e("v-text",[t._v("投票")])],1),t._v(" "),e(c.a,{attrs:{icon:""},on:{click:function(t){r.detail_show=!r.detail_show}}},[e(f.a,[t._v(t._s(r.detail_show?"mdi-chevron-up":"mdi-chevron-down"))])],1)],1)],1),t._v(" "),e(x.a,[e("div",{directives:[{name:"show",rawName:"v-show",value:r.detail_show,expression:"used_ticket.detail_show"}],staticClass:"pa-1"},[e(m.a),t._v(" "),e(_.c,{staticClass:"pa-1"},[e("a",{staticClass:"text-body-2 mx-0 my-0 pa-0",attrs:{href:"/groups/"+r.group.id}},[t._v(t._s(r.group.groupname)+"の団体紹介ページ")]),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e(f.a,[t._v("mdi-clock-time-nine")]),e("span",{staticClass:"grey--text text--darken-2"},[t._v("開幕時刻：")]),t._v(t._s(t.DateFormatter(r.timetable.starts_at))+" ~ "+t._s(t.DateFormatter(r.timetable.ends_at)))],1),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e(f.a,[t._v("mdi-account-supervisor")]),e("span",{staticClass:"grey--text text--darken-2"},[t._v("同時入場人数：")]),t._v(t._s(r.ticket.person))],1),t._v(" "),e("p",{staticClass:"text-body-2 mx-0 my-0 pa-0"},[e("span",{staticClass:"grey--text text--darken-2"},[t._v("チケットID:")]),t._v(t._s(r.ticket.id))])])],1)])],1),t._v(" "),e("div",{staticClass:"my-2"})],1)})),t._v(" "),0==t.used_tickets.length?e("div",{staticClass:"pa-3"},[e("p",[t._v("ここに表示するものはありません")]),t._v(" "),e("a",{staticClass:"amber--text text--darken-4",attrs:{href:"/groups"}},[t._v("次に見たい公演を探しに行きましょう✨")])]):t._e()],2)],1)],1)],1),t._v(" "),e(w.a,{attrs:{color:"success",elevation:"2"},model:{value:t.success_alert,callback:function(e){t.success_alert=e},expression:"success_alert"}},[t._v("\n        "+t._s(t.success_message)+"\n      ")]),t._v(" "),e(w.a,{attrs:{color:"red",elevation:"2"},model:{value:t.error_alert,callback:function(e){t.error_alert=e},expression:"error_alert"}},[t._v("\n        "+t._s(t.error_message)+"\n      ")])],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);